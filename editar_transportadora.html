<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Editar Transportadora</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script>
		var formulario;
		var input_nome;
		var input_situacao = {};	//mais simples e eficiente usar como objeto 
		var id_transportadora;
		var bt_confirmar;
		var bt_cancelar;

		var flag_nome_alterado;
		var flag_ativa_alterado;
		//funcao copiada desse link
		//http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
		function getParameterByName(name, url) {
		    if (!url) {
		      url = window.location.href;
		    }
		    name = name.replace(/[\[\]]/g, "\\$&");
		    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
		        results = regex.exec(url);
		    if (!results) return null;
		    if (!results[2]) return '';
		    return decodeURIComponent(results[2].replace(/\+/g, " "));
		}

		$(document).ready(function(){
			formulario = document.getElementById('formulario');
			input_nome = document.getElementById('input_nome');
			input_nome.value = getParameterByName('nome_transportadora');
			input_nome.addEventListener('keydown',function(){
				flag_nome_alterado = true;
			});
			var situacao = getParameterByName('situacao_transportadora');
			input_situacao['ativa'] = formulario.elements[2];
			input_situacao['inativa'] = formulario.elements[3];
			input_situacao[situacao].checked = true;
			input_situacao['ativa'].addEventListener('click',function(){
				flag_ativa_alterado = true;
				input_situacao['checked'] = input_situacao['ativa'];
			});
			input_situacao['inativa'].addEventListener('click',function(){
				flag_ativa_alterado = true;
				input_situacao['checked'] = input_situacao['inativa'];
			});
			id_transportadora = getParameterByName('id_transportadora');
		});
	</script>
</head>
<body>
	<h1>Editar Transportadora</h1>
	<br><br>
	<div id="div_form">
		<form method="post" action="index_transportadora.php" id="formulario">
			<fieldset>
				Nome: <input type="text" name="nome_transportadora" id="input_nome"></input>
				<br><br>
				Situação: <input type="radio" name="situacao_transportadora" id="input_sit_ativa" value="1" required>Ativa</input>
				<input type="radio" name="situacao_transportadora" id="input_sit_inativa" value="0" required>Inativa</input> 
			</fieldset>
		</form>
	</div>
	<br><br>
	<button type="button" id="bt_confirmar">Confirmar Alterações</button>
	<button type="button" id="bt_cancelar">Cancelar</button>
	<script>
		bt_confirmar = document.getElementById('bt_confirmar');		
		bt_confirmar.addEventListener('click',function(){
			var resposta = window.confirm("Confirmar alterações?");
			if(resposta){
				var data = {
					'function' : 'update',
					'id_transportadora' : id_transportadora
				};
				if(flag_nome_alterado){
					data['nome'] = input_nome.value;
				}
				if(flag_ativa_alterado){
					data['ativa'] = input_situacao['checked'].value;
				}
				var url = 'index_transportadora.php';
				$.ajax({
					type : "POST",
					url : url,
					data : data,
					success : function(result){
						alert(result);
					},
					error : function(xhr,error){
						alert(error);
					}
				});
			}else{
				return;
			}
		});
	</script>
</body>
</html>